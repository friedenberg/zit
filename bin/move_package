#! /bin/bash -e

prefix=github.com/friedenberg/zit
original="${1%/}"
renamed="${2%/}"
renamed_pkg="$(basename "$renamed")"

gofmt -w -r "$original.E -> $renamed_pkg.E" ./
gofmt -w -r "$original -> $renamed_pkg" ./
goimports -w ./

mkdir -p "$(dirname "$renamed")"

git mv "$original" "$renamed" || mv "$original" "$renamed"

ag "$prefix/$original" -l0 \
  | xargs -0 sed -i '' "s|$prefix/$original|$prefix/$renamed|g"
